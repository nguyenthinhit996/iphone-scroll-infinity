<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Infinite Scroll v5 - Unsplash API Demo</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    body {
      font-family: sans-serif;
      line-height: 1.4;
      padding: 20px;
      max-width: 640px;
      margin: 0 auto;
    }
    .photo-item {
      margin: 40px 0;
      padding-top: 20px;
      border-top: 1px solid #DDD;
    }
    .photo-item__image {
      display: block;
      max-width: 100%;
    }
    .page-load-status {
      display: none;
      padding-top: 20px;
      border-top: 1px solid #DDD;
      text-align: center;
      color: #777;
    }
  </style>
</head>
<body>
  <h1>Infinite Scroll v5 - Unsplash API Demo</h1>
  <p>
    Loading photos from the
    <a href="https://unsplash.com/developers" target="_blank">Unsplash API</a>
  </p>

  <div class="container"></div>

  <div class="page-load-status">
    <div class="loader-ellips infinite-scroll-request">
      <span class="loader-ellips__dot"></span>
      <span class="loader-ellips__dot"></span>
      <span class="loader-ellips__dot"></span>
      <span class="loader-ellips__dot"></span>
    </div>
    <p class="infinite-scroll-last">End of content</p>
    <p class="infinite-scroll-error">No more pages to load</p>
  </div>

  <script type="text/html" id="photo-item-template">
    <div class="photo-item">
      <img class="photo-item__image" src="{{urls.regular}}" alt="Photo by {{user.name}}" />
      <p class="photo-item__caption">
        <a href="{{user.links.html}}" target="_blank">{{user.name}}</a>
      </p>
    </div>
  </script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
  <!-- Infinite Scroll v5 (MIT licensed) -->
  <script src="https://unpkg.com/infinite-scroll@5/dist/infinite-scroll.pkgd.min.js"></script>
  <script>
    const container = document.querySelector('.container');
    const $container = $(container);
    const unsplashID = '9ad80b14098bcead9c7de952435e937cc3723ae61084ba8e729adb642daf0251';

    // Initialize Infinite Scroll (v5 syntax)
    const infScroll = new InfiniteScroll(container, {
      path() {
        return `https://api.unsplash.com/photos?client_id=${unsplashID}&page=${this.pageIndex}`;
      },
      responseBody: 'json',
      status: '.page-load-status',
      history: false,
    });

    $container.on('load.infiniteScroll', function( event, data ) {
      const template = document.getElementById('photo-item-template').innerHTML;
      const html = data.map((photo) => microTemplate(template, photo)).join('');
      const doc = new DOMParser().parseFromString(html, 'text/html');
      const items = doc.body.children;
      infScroll.appendItems(items);
    });

    // Kick off initial load
    infScroll.loadNextPage();

    // Simple template function
    function microTemplate(src, data) {
      return src.replace(/\{\{([\w\-_\.]+)\}\}/gi, (match, key) => {
        return key.split('.').reduce((val, part) => val?.[part], data) ?? '';
      });
    }
  </script>
</body>
</html>
